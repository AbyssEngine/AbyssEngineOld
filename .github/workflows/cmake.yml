name: cmake-workflow
on: [ push ]

jobs:
    job:
        name: ${{ matrix.os }}-hosted-pure
        runs-on: ${{ matrix.os }}
        strategy:
            fail-fast: false
            matrix:
                os: [ ubuntu-latest, macos-latest, windows-latest ]
                include:
                    -   os: windows-latest
                        triplet: x64-windows
                    -   os: ubuntu-latest
                        triplet: x64-linux
                    -   os: macos-latest
                        triplet: x64-osx
        env:
            CMAKE_BUILD_DIR: ${{ github.workspace }}/builddir/
            VCPKG_ROOT: ${{ github.workspace }}/vcpkg

        steps:
            -   uses: actions/checkout@latest

            -   uses: lukka/get-cmake@latest

            -   name: Run vcpkg
                uses: lukka/run-vcpkg@latest
                with:
                    setupOnly: true
                    vcpkgDirectory: '${{ github.workspace }}/vcpkg'
                    vcpkgGitCommitId: '5568f110b509a9fd90711978a7cb76bae75bb092'
                    appendedCacheKey: ${{ hashFiles( '**/vcpkg.json' ) }}
                    additionalCachedPaths: ${{ env.buildDir }}/vcpkg_installed


            -   name: cmake
                uses: lukka/run-cmake@latest
                with:
                    configurePreset: 'ninja-multi-vcpkg'
                    buildPreset: 'ninja-multi-vcpkg'
